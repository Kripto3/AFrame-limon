<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Mi primer Aframe</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.2/dist/aframe-environment-component.min.js"></script>
    <script src="game.js"></script>
  </head>
  <body>
    <a-scene>
      <a-entity environment="preset:forest"></a-entity>
      <a-entity laser-controls></a-entity>
      <a-camera>
        <a-text
          id="score-element"
          value="Score"
          position="-0.35 0.5 -0.8"
        ></a-text>
        <a-cursor></a-cursor>
      </a-camera>
    </a-scene>
    <a-gltf-model
      id="heart-model"
      src="scene.gltf"
      position="0 1.5 -5"
      scale="0.01 0.01 0.01"
      animation="property: rotation; to: 0 360 0; loop: true; easing: linear; dur: 2000"
      animation__collect="property: position; to: 0 0 0; dur: 300; startEvents: collected"
      animation__minimize="property: scale; to: 0 0 0; dur: 300; startEvents: collected"
    >
    </a-gltf-model>
  </body>
  <script>
    const sceneEl = document.querySelector("a-scene");
    const heartEl = document.querySelector("#heart-model");
    const scoreEl = document.querySelector("#score-element");

    let score = 1;

    //set and show new score
    function displayScore() {
      scoreEl.setAttribute("value", `Score: ${score}`);
    }

    //random position of lemon
    function randomPosition() {
      return {
        x: (Math.random() - 0.5) * 20,
        y: 1.5,
        z: (Math.random() - 0.5) * 20,
      };
    }

    function createHeart() {
      const clone = heartEl.cloneNode();
      clone.setAttribute("position", randomPosition());
      clone.addEventListener("mousedown", () => {
        score++;
        clone.dispatchEvent(new Event("collected"));
        displayScore();
      });
      clone.addEventListener("animationcomplete", () => {
        clone.setAttribute("position", randomPosition());
        clone.setAttribute("scale", "0.01 0.01 0.01");
      });
      sceneEl.appendChild(clone);
    }

    for (let i = 0; i < 15; i++) {
      createHeart();
    }

    displayScore();
  </script>
</html>
